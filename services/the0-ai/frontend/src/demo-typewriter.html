<!doctype html>
<html>
  <head>
    <title>Typewriter Effect Demo</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
        background: #1a1a1a;
        color: #fff;
      }
      .demo-container {
        max-width: 600px;
        margin: 0 auto;
      }
      .message {
        background: #2a2a2a;
        padding: 15px;
        border-radius: 8px;
        margin: 10px 0;
        position: relative;
      }
      .cursor {
        display: inline-block;
        width: 8px;
        height: 20px;
        background: #22c55e;
        animation: pulse 1s infinite;
        margin-left: 4px;
      }
      @keyframes pulse {
        0%,
        50% {
          opacity: 1;
        }
        51%,
        100% {
          opacity: 0;
        }
      }
      .controls {
        margin: 20px 0;
        padding: 15px;
        background: #2a2a2a;
        border-radius: 8px;
      }
      .speed-control {
        margin: 10px 0;
      }
      input[type='range'] {
        width: 100%;
        margin: 5px 0;
      }
      button {
        background: #22c55e;
        color: white;
        border: none;
        padding: 8px 16px;
        border-radius: 4px;
        cursor: pointer;
        margin: 5px;
      }
      button:hover {
        background: #16a34a;
      }
    </style>
  </head>
  <body>
    <div class="demo-container">
      <h1>ðŸŽ­ Typewriter Effect Demo</h1>
      <p>
        This demonstrates the typewriter effect that smooths out fast streaming responses from
        Gemini.
      </p>

      <div class="controls">
        <div class="speed-control">
          <label>Speed: <span id="speedDisplay">50</span> chars/sec</label>
          <input type="range" id="speedSlider" min="10" max="200" value="50" step="10" />
        </div>
        <button onclick="startDemo()">Start Demo</button>
        <button onclick="stopDemo()">Stop</button>
        <button onclick="clearDemo()">Clear</button>
      </div>

      <div id="messageContainer" class="message">
        <span id="messageText"></span><span id="cursor" class="cursor" style="display: none"></span>
      </div>

      <h3>What this simulates:</h3>
      <ul>
        <li><strong>Fast Gemini Streaming:</strong> Tokens arrive very quickly in chunks</li>
        <li><strong>Typewriter Buffering:</strong> Chunks are queued and displayed smoothly</li>
        <li><strong>Visual Polish:</strong> Creates a pleasant reading experience</li>
        <li><strong>User Control:</strong> Speed can be adjusted from 10-200 chars/sec</li>
      </ul>
    </div>

    <script>
      let typewriterInterval
      let messageQueue = []
      let currentText = ''
      let isTyping = false
      let speed = 50

      const messageText = document.getElementById('messageText')
      const cursor = document.getElementById('cursor')
      const speedSlider = document.getElementById('speedSlider')
      const speedDisplay = document.getElementById('speedDisplay')

      speedSlider.addEventListener('input', e => {
        speed = parseInt(e.target.value)
        speedDisplay.textContent = speed
      })

      // Sample streaming chunks that would come from Gemini
      const sampleChunks = [
        "Hello! I'll help you create a ",
        "powerful trading bot. Let's start by ",
        'analyzing the market trends and ',
        'implementing a simple moving average strategy.\n\n',
        "Here's what we'll build:\n\n",
        '1. **Data Collection**: Fetch real-time market data\n',
        '2. **Signal Generation**: Use technical indicators\n',
        '3. **Risk Management**: Implement stop-loss and take-profit\n',
        '4. **Execution**: Place orders automatically\n\n',
        '```python\n',
        'def calculate_sma(prices, window):\n',
        '    return sum(prices[-window:]) / window\n\n',
        'def trading_signal(current_price, sma_short, sma_long):\n',
        '    if sma_short > sma_long:\n',
        "        return 'BUY'\n",
        '    elif sma_short < sma_long:\n',
        "        return 'SELL'\n",
        "    return 'HOLD'\n",
        '```\n\n',
        'This strategy will help you get started with algorithmic trading!',
      ]

      function addToQueue(chunk) {
        messageQueue.push(chunk)
        if (!isTyping) {
          startTyping()
        }
      }

      function startTyping() {
        if (isTyping || messageQueue.length === 0) return

        isTyping = true
        cursor.style.display = 'inline-block'

        const intervalMs = 1000 / speed
        let currentChunk = messageQueue.shift() || ''
        let chunkIndex = 0

        typewriterInterval = setInterval(() => {
          if (chunkIndex >= currentChunk.length) {
            if (messageQueue.length > 0) {
              currentChunk = messageQueue.shift() || ''
              chunkIndex = 0
              return
            }

            // Done typing
            clearInterval(typewriterInterval)
            isTyping = false
            cursor.style.display = 'none'
            return
          }

          // Add 1-3 characters for natural feel
          const charsToAdd = Math.min(
            Math.floor(Math.random() * 3) + 1,
            currentChunk.length - chunkIndex
          )

          const newChars = currentChunk.slice(chunkIndex, chunkIndex + charsToAdd)
          chunkIndex += charsToAdd

          currentText += newChars
          messageText.textContent = currentText
        }, intervalMs)
      }

      function startDemo() {
        stopDemo()
        clearDemo()

        // Simulate chunks arriving quickly
        sampleChunks.forEach((chunk, index) => {
          setTimeout(() => addToQueue(chunk), index * 100) // Chunks arrive every 100ms
        })
      }

      function stopDemo() {
        clearInterval(typewriterInterval)
        isTyping = false
        cursor.style.display = 'none'
        messageQueue = []
      }

      function clearDemo() {
        stopDemo()
        currentText = ''
        messageText.textContent = ''
      }
    </script>
  </body>
</html>
