# Default values for the0
# This configuration works out-of-the-box with minikube using local images

# Global settings
global:
  # Image pull policy for local development (use cached images)
  imagePullPolicy: Never
  # For production with DockerHub images, use: Always

  # Storage class for persistent volumes (leave empty for default)
  storageClass: ""

  # Provide an existing Secret name to skip auto-generation of the chart Secret.
  # The Secret must contain these keys:
  #   postgresql-password, mongodb-root-password, minio-access-key, minio-secret-key,
  #   database-url, mongo-url, jwt-secret
  # Works with Sealed Secrets, External Secrets Operator, etc.
  existingSecret: ""

# Infrastructure Services
# Set enabled: false to use external services in production

postgresql:
  enabled: true
  image: postgres:15-alpine
  port: 5432
  database: the0_oss
  username: the0
  password: the0_password
  sslmode: disable
  persistence:
    enabled: true
    size: 10Gi
  resources:
    requests:
      memory: 256Mi
      cpu: 100m
    limits:
      memory: 512Mi
      cpu: 500m
  external:
    host: ""
    port: 5432
    database: the0_oss
    username: ""
    password: ""
    sslmode: require
    connectionString: ""  # overrides individual fields if set

mongodb:
  enabled: true
  image: mongo:7-jammy
  port: 27017
  rootUsername: root
  rootPassword: the0_mongo_password
  database: bot_runner
  persistence:
    enabled: true
    size: 10Gi
  resources:
    requests:
      memory: 256Mi
      cpu: 100m
    limits:
      memory: 512Mi
      cpu: 500m
  external:
    host: ""
    port: 27017
    username: ""
    password: ""
    database: bot_runner
    authSource: admin
    options: ""
    connectionString: ""  # overrides individual fields if set

nats:
  enabled: true
  image: nats:2.10-alpine
  port: 4222
  monitoringPort: 8222
  persistence:
    enabled: true
    size: 5Gi
  resources:
    requests:
      memory: 128Mi
      cpu: 50m
    limits:
      memory: 256Mi
      cpu: 200m
  external:
    host: ""
    port: 4222
    url: ""  # overrides host:port if set

minio:
  enabled: true
  image: minio/minio:latest
  port: 9000
  consolePort: 9001
  accessKey: the0admin
  secretKey: the0password
  persistence:
    enabled: true
    size: 20Gi
  resources:
    requests:
      memory: 256Mi
      cpu: 100m
    limits:
      memory: 512Mi
      cpu: 500m
  external:
    endpoint: ""
    port: 443
    useSSL: true
    accessKey: ""
    secretKey: ""
    region: ""

# Application Services

the0Api:
  enabled: true
  replicas: 1
  # Local image (default)
  image:
    repository: the0-api
    # tag defaults to Chart appVersion; override for local dev:
    # tag: latest
  # DockerHub image (uncomment for production)
  # image:
  #   repository: the0org/the0-api
  #   tag: latest
  port: 3000
  env:
    # Application configuration
    DATABASE_TYPE: "postgres"
    MINIO_EXTERNAL_ENDPOINT: "minio.the0.local:30002"
    STORAGE_PATH: "/app/uploads/custom-bots"
    CUSTOM_BOTS_BUCKET: "custom-bots"
    LOG_BUCKET: "bot-logs"
    BACKTEST_BUCKET: "backtests"
    NODE_ENV: "development"
    PORT: "3000"
    API_BASE_URL: "http://the0-api:3000"
    FRONTEND_URL: "http://the0.local:30001"
    JWT_SECRET: "your-jwt-secret-key"
    JWT_EXPIRES_IN: "7d"
    RUNTIME_QUERY_URL: "http://the0-bot-controller:9477"
  resources:
    requests:
      memory: 512Mi
      cpu: 200m
    limits:
      memory: 1Gi
      cpu: 1000m

the0Frontend:
  enabled: true
  replicas: 1
  # Local image (default)
  image:
    repository: the0-frontend
    # tag defaults to Chart appVersion; override for local dev:
    # tag: latest
  # DockerHub image (uncomment for production)
  # image:
  #   repository: the0org/the0-frontend
  #   tag: latest
  port: 3000
  env:
    # Frontend configuration (using NodePort URLs)
    # Note: NEXT_PUBLIC_API_URL and NEXT_PUBLIC_DOCS_URL are set via build args in Makefile
    # Note: BOT_API_URL is dynamically constructed in the template
    NEXT_PUBLIC_APP_NAME: "the0"
    NEXT_PUBLIC_APP_VERSION: "1.0.0"
    NEXT_BASE_URL: "http://the0.local:30001"
    NODE_ENV: "development"
    JWT_SECRET: "your-jwt-secret-key"
  resources:
    requests:
      memory: 256Mi
      cpu: 100m
    limits:
      memory: 512Mi
      cpu: 500m

the0Docs:
  enabled: true
  replicas: 1
  # Local image (default)
  image:
    repository: the0-docs
    # tag defaults to Chart appVersion; override for local dev:
    # tag: latest
  # DockerHub image (uncomment for production)
  # image:
  #   repository: the0org/the0-docs
  #   tag: latest
  port: 80  # nginx serves on port 80
  env:
    # Documentation configuration
    NEXT_PUBLIC_APP_NAME: "the0"
    NEXT_PUBLIC_APP_VERSION: "1.0.0"
    NODE_ENV: "development"
  resources:
    requests:
      memory: 128Mi
      cpu: 50m
    limits:
      memory: 256Mi
      cpu: 200m

# Kubernetes-Native Bot Controller
# Manages bot Pods and CronJobs directly - no Docker-in-Docker needed
botController:
  enabled: true
  replicas: 1
  image:
    repository: runtime
    # tag defaults to Chart appVersion; override for local dev:
    # tag: latest
  # runtimeImage defaults to repository:appVersion; override for local dev:
  # runtimeImage: "runtime:latest"
  # Image pull policy for runtime image (Never for local minikube, Always for production)
  runtimeImagePullPolicy: "Never"
  # How often to reconcile state with MongoDB
  reconcileInterval: "30s"
  # Environment variables for the controller
  # Each entry supports standard K8s env syntax: value, valueFrom, secretKeyRef, etc.
  # For production, use secretKeyRef to reference Sealed Secrets
  # Additional environment variables (supports standard K8s env syntax)
  # For production, use secretKeyRef to reference Sealed Secrets:
  # env:
  #   - name: MONGO_URI
  #     valueFrom:
  #       secretKeyRef:
  #         name: the0-secrets
  #         key: MONGO_URI
  env: []
  # MinIO configuration for bot code storage
  minio:
    bucket: "custom-bots"
  resources:
    requests:
      memory: 256Mi
      cpu: 100m
    limits:
      memory: 512Mi
      cpu: 500m

# Service configuration
service:
  type: ClusterIP
  # For production clusters, use ingress for external access

# External services configuration (NodePort with fixed ports)
externalServices:
  # Enable NodePort services for external access
  # Uses fixed ports for predictable .local domain mapping
  enabled: true
  nodePort:
    frontend: 30001  # the0.local:30001
    api: 30000       # api.the0.local:30000
    minio: 30002     # minio.the0.local:30002
    docs: 30004      # docs.the0.local:30004

# Minikube configuration  
minikube:
  # Enable minikube-specific optimizations
  enabled: true

# Ingress configuration (disabled - using NodePort instead)
ingress:
  enabled: false