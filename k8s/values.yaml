# Default values for the0
# This configuration works out-of-the-box with minikube using local images

# Global settings
global:
  # Image pull policy for local development (use cached images)
  imagePullPolicy: Never
  # For production with DockerHub images, use: Always
  
  # Storage class for persistent volumes (leave empty for default)
  storageClass: ""

# Infrastructure Services
# Set enabled: false to use external services in production

postgresql:
  enabled: true
  image: postgres:15-alpine
  port: 5432
  persistence:
    enabled: true
    size: 10Gi
  resources:
    requests:
      memory: 256Mi
      cpu: 100m
    limits:
      memory: 512Mi
      cpu: 500m

mongodb:
  enabled: true
  image: mongo:7-jammy
  port: 27017
  persistence:
    enabled: true
    size: 10Gi
  resources:
    requests:
      memory: 256Mi
      cpu: 100m
    limits:
      memory: 512Mi
      cpu: 500m

nats:
  enabled: true
  image: nats:2.10-alpine
  port: 4222
  monitoringPort: 8222
  persistence:
    enabled: true
    size: 5Gi
  resources:
    requests:
      memory: 128Mi
      cpu: 50m
    limits:
      memory: 256Mi
      cpu: 200m

minio:
  enabled: true
  image: minio/minio:latest
  port: 9000
  consolePort: 9001
  accessKey: the0admin
  secretKey: the0password
  persistence:
    enabled: true
    size: 20Gi
  resources:
    requests:
      memory: 256Mi
      cpu: 100m
    limits:
      memory: 512Mi
      cpu: 500m

# Application Services

the0Api:
  enabled: true
  replicas: 1
  # Local image (default)
  image:
    repository: the0-api
    tag: latest
  # DockerHub image (uncomment for production)
  # image:
  #   repository: the0org/the0-api
  #   tag: latest
  port: 3000
  env:
    # Database configuration
    DATABASE_URL: "postgresql://the0:the0_password@the0-postgres:5432/the0_oss?sslmode=disable"
    DATABASE_TYPE: "postgres"
    
    # NATS configuration
    NATS_URLS: "nats://the0-nats:4222"
    
    # MinIO configuration
    MINIO_ENDPOINT: "the0-minio"
    MINIO_EXTERNAL_ENDPOINT: "minio.the0.local:30002"
    MINIO_PORT: "9000"
    MINIO_USE_SSL: "false"
    MINIO_ACCESS_KEY: "the0admin" 
    MINIO_SECRET_KEY: "the0password"
    
    # Storage configuration
    STORAGE_PATH: "/app/uploads/custom-bots"
    CUSTOM_BOTS_BUCKET: "custom-bots"
    LOG_BUCKET: "bot-logs"
    BACKTEST_BUCKET: "backtests"
    
    # Application configuration
    NODE_ENV: "development"
    PORT: "3000"
    API_BASE_URL: "http://the0-api:3000"
    FRONTEND_URL: "http://the0.local:30001"
    JWT_SECRET: "your-jwt-secret-key"
    JWT_EXPIRES_IN: "7d"
  resources:
    requests:
      memory: 512Mi
      cpu: 200m
    limits:
      memory: 1Gi
      cpu: 1000m

the0Frontend:
  enabled: true
  replicas: 1
  # Local image (default)
  image:
    repository: the0-frontend
    tag: latest
  # DockerHub image (uncomment for production)
  # image:
  #   repository: the0org/the0-frontend
  #   tag: latest
  port: 3000
  env:
    # Frontend configuration (using NodePort URLs)
    # Note: NEXT_PUBLIC_API_URL and NEXT_PUBLIC_DOCS_URL are set via build args in Makefile
    # Note: BOT_API_URL is dynamically constructed in the template
    NEXT_PUBLIC_APP_NAME: "the0"
    NEXT_PUBLIC_APP_VERSION: "1.0.0"
    NEXT_BASE_URL: "http://the0.local:30001"
    NODE_ENV: "development"
    JWT_SECRET: "your-jwt-secret-key"
  resources:
    requests:
      memory: 256Mi
      cpu: 100m
    limits:
      memory: 512Mi
      cpu: 500m

the0Docs:
  enabled: true
  replicas: 1
  # Local image (default)
  image:
    repository: the0-docs
    tag: latest
  # DockerHub image (uncomment for production)
  # image:
  #   repository: the0org/the0-docs
  #   tag: latest
  port: 80  # nginx serves on port 80
  env:
    # Documentation configuration
    NEXT_PUBLIC_APP_NAME: "the0"
    NEXT_PUBLIC_APP_VERSION: "1.0.0"
    NODE_ENV: "development"
  resources:
    requests:
      memory: 128Mi
      cpu: 50m
    limits:
      memory: 256Mi
      cpu: 200m

# Kubernetes-Native Bot Controller
# Manages bot Pods and CronJobs directly - no Docker-in-Docker needed
botController:
  enabled: true
  replicas: 1
  image:
    repository: runtime
    tag: latest
  # Runtime image for init containers and sidecars in bot pods
  runtimeImage: "runtime:latest"
  # Image pull policy for runtime image (Never for local minikube, Always for production)
  runtimeImagePullPolicy: "Never"
  # How often to reconcile state with MongoDB
  reconcileInterval: "30s"
  # Environment variables for the controller
  # Each entry supports standard K8s env syntax: value, valueFrom, secretKeyRef, etc.
  # For production, use secretKeyRef to reference Sealed Secrets
  env:
    # MongoDB connection string
    - name: MONGO_URI
      value: "mongodb://root:the0_mongo_password@the0-mongo:27017"
    # NATS connection for syncing bots from API
    - name: NATS_URL
      value: "nats://the0-nats:4222"
    # MinIO credentials for image builder
    - name: MINIO_ACCESS_KEY
      value: "the0admin"
    - name: MINIO_SECRET_KEY
      value: "the0password"
    # Example: Using secretKeyRef for production (uncomment and modify):
    # - name: MONGO_URI
    #   valueFrom:
    #     secretKeyRef:
    #       name: the0-secrets  # Your Sealed Secret name
    #       key: MONGO_URI
    # - name: MINIO_ACCESS_KEY
    #   valueFrom:
    #     secretKeyRef:
    #       name: the0-secrets
    #       key: MINIO_ACCESS_KEY
    # - name: MINIO_SECRET_KEY
    #   valueFrom:
    #     secretKeyRef:
    #       name: the0-secrets
    #       key: MINIO_SECRET_KEY
  # MinIO configuration for bot code storage
  minio:
    endpoint: "the0-minio:9000"
    bucket: "custom-bots"
  resources:
    requests:
      memory: 256Mi
      cpu: 100m
    limits:
      memory: 512Mi
      cpu: 500m

# Service configuration
service:
  type: ClusterIP
  # For production clusters, use ingress for external access

# External services configuration (NodePort with fixed ports)
externalServices:
  # Enable NodePort services for external access
  # Uses fixed ports for predictable .local domain mapping
  enabled: true
  nodePort:
    frontend: 30001  # the0.local:30001
    api: 30000       # api.the0.local:30000
    minio: 30002     # minio.the0.local:30002
    docs: 30004      # docs.the0.local:30004

# Minikube configuration  
minikube:
  # Enable minikube-specific optimizations
  enabled: true

# Ingress configuration (disabled - using NodePort instead)
ingress:
  enabled: false